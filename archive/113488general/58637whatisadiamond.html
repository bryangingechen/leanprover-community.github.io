---
layout: page
title: Lean Prover Zulip Chat Archive 
permalink: archive/113488general/58637whatisadiamond.html
---

<h2>Stream: <a href="https://leanprover-community.github.io/archive/113488general/index.html">general</a>
<h3>Topic: <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html">what is a diamond?</a></h3>

<hr>

<base href="https://leanprover.zulipchat.com">
{% raw %}
<a name="163833275"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/163833275" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#163833275">Kevin Buzzard (Apr 21 2019 at 04:00)</a>:</h4>
<p><a href="https://github.com/kbuzzard/xena/blob/master/Examples/Category_5_Diamond.lean" target="_blank" title="https://github.com/kbuzzard/xena/blob/master/Examples/Category_5_Diamond.lean">The Category 5 Diamond (Xena)</a>.</p>
<p>What is a typeclass diamond (note : this has nothing to do with Scholze's diamonds, it's an unfortunate name-clash)? I think it's something like the above link. Two distinct instance routes from A to D, with typeclass inference giving us two terms of type D which are provably distinct. I am assuming that the system should be regarded as having failed at this point. How much can I get away with? I think there are other lower category diamonds as well though, right? What other things can go wrong? Instances which are equal but not computably equal? Instances which are equal but not definitionally equal? Is there some sort of complete catalogue of diamonds?</p>

<a name="163833380"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/163833380" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#163833380">Keeley Hoek (Apr 21 2019 at 04:03)</a>:</h4>
<p>With regard to auto-naming, what do you think a good strategy for naming those would be? It would <del>probably</del> be really easy to implement</p>

<a name="163833569"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/163833569" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#163833569">Kevin Buzzard (Apr 21 2019 at 04:09)</a>:</h4>
<p>I was going from <code>xena.B</code> to <code>xena.D</code> in my example, in the xena namespace, and getting a name which depended only on <code>D</code>. I guess I want to have B tagging along somehow. Is there some clever thing you can do with dots?</p>

<a name="164268877"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/164268877" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#164268877">Floris van Doorn (Apr 26 2019 at 14:55)</a>:</h4>
<p>I think the term <code>type class diamond</code> is used whenever there are two ways to go from class <code>A</code> to class <code>D</code>, regardless of whether the two resulting instances are definitionally equal or not. I think it will be quite a big problem if you have a diamond and the resulting instances are not definitionally equal (whether they are provably equal is less important. I think we should restrict instances enough so that we don't get these kinds of bad diamonds.</p>

<a name="164268887"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/164268887" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#164268887">Floris van Doorn (Apr 26 2019 at 14:55)</a>:</h4>
<p>golf:</p>
<div class="codehilite"><pre><span></span>theorem you_are_in_typeclass_trouble_now : d1 ≠ d2 := by rintro ⟨⟩
</pre></div>

<a name="164269265"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/164269265" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#164269265">Johan Commelin (Apr 26 2019 at 14:58)</a>:</h4>
<p>If the class is a subsingleton, I want to be able to use non-defeq instances.</p>

<a name="164269295"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/164269295" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#164269295">Johan Commelin (Apr 26 2019 at 14:59)</a>:</h4>
<p>That ought to be possible, right?</p>

<a name="164270793"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/164270793" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#164270793">Kevin Buzzard (Apr 26 2019 at 15:14)</a>:</h4>
<p>That currently is annoying. <span class="user-mention" data-user-id="110024">@Sebastian Ullrich</span> I know the type class system will not be changing, but this issue about typeclass inference failing to do subsingleton elimination is something we mathematicians are beginning to run into. Am I asking for <code>rfl++</code> or something?</p>

<a name="164270868"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/164270868" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#164270868">Patrick Massot (Apr 26 2019 at 15:15)</a>:</h4>
<p>I don't think Sebastian said the type class system won't change. He wrote they didn't know yet what would be a better system. It's clear it has to improve, the current system simply doesn't scale.</p>

<a name="164271044"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/164271044" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#164271044">Patrick Massot (Apr 26 2019 at 15:18)</a>:</h4>
<p>Part of the problem is indeed type-theoretic but, as far as I understand, most of the issues are completely generic (in which order do we search, what is cached, etc.)</p>

<a name="165756571"></a>
<h4><a href="https://leanprover.zulipchat.com/#narrow/stream/113488-general/topic/what%20is%20a%20diamond%3F/near/165756571" class="zl"><img src="https://leanprover-community.github.io/assets/img/zulip2.png" alt="view this post on Zulip"></a> <a href="https://leanprover-community.github.io/archive/113488general/58637whatisadiamond.html#165756571">Wojciech Nawrocki (May 15 2019 at 21:31)</a>:</h4>
<p>Ralf Jung, who's a Coq expert, just wrote <a href="https://www.ralfj.de/blog/2019/05/15/typeclasses-exponential-blowup.html" target="_blank" title="https://www.ralfj.de/blog/2019/05/15/typeclasses-exponential-blowup.html">a blog post (link)</a> about the problems diamonds cause and possible solutions. It seems that it's still a mostly unsolved problem, and possibly some issues you encounter here are due to the exponential blowup described there.</p>


{% endraw %}
